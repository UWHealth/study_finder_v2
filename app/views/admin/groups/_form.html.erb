<%= simple_form_for [:admin, @group] do |f| %>
  <%= f.input :group_name, label: 'Group name' %>
  <%= f.label 'Subgroup(s):' %>
  <p class="text-muted">*Note: Subgroups function by appending the subgroup name to the search string (as if an end user typed a word into the search box).</p>
  <%= f.simple_fields_for :subgroups do |sg| %>
    <fieldset>
      <div class="form-inline">
        <%= sg.input :name, label: false %>
        <%= sg.hidden_field :_destroy %>
        <div class='remove-btn'><%= link_to '<i class="fa fa-trash"></i>'.html_safe, '#', class: "remove_fields" %></div>
      </div>
    </fieldset>
  <% end %>
  <hr/>
  
  <div class="form-group">
    <label>Filters</label>
    <%= f.input :children, label: 'Children (age < 18 years)' %>
    <%= f.input :adults, label: 'Adults (age >= 18 years)' %>
    <label for='group_heathy_volunteers' data-toggle= 'popover' data-title= 'Healthy Volunteer' data-content= 'A person who does not have the condition or disease being studied.' data-placement='top'>Healthy Volunteers <i class="fa fa-question-circle"></i></label>
    <%= f.input :healthy_volunteers, as: :select, collection: [['Please Select',''],['Yes',true],['No',false]], label: false, include_blank: false %>
  </div>

  <hr/>

  <label>Choose all conditions that apply</label><br>
  <%= f.collection_check_boxes :condition_ids, @conditions, :id, :condition, :item_wrapper_class => 'd-block checkbox' %>

  <div class="controls">
    <%= f.submit 'Save Group', class: 'btn btn-school' %>
    <%= link_to 'Back to group admin', admin_groups_path, class: 'btn btn-outline-secondary' %>
    <% if params[:action] == 'edit' %>
      <%= link_to 'Export to Excel', edit_admin_group_path(id: params[:id], format: 'csv'), class: 'btn btn-success' %>
    <% end%>
  </div>
<% end %>

<script>
  $(document).ready(function() {

    $('form').on('click', '.remove_fields', function(event) {
      $(this).parent().prev('input[type=hidden]').val('1');
      $(this).closest('fieldset').hide();
      return event.preventDefault();
    });

    //don't display the last remove button as it's for a new subgroup
    $('.remove-btn').last().hide();
  });
</script>